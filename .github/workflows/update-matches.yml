name: Update Matches Data
on:
  schedule:
    - cron: '0 */6 * * *'  # كل 6 ساعات
  workflow_dispatch:

jobs:
  update:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Set up Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'
      
      - name: Create data directory
        run: mkdir -p data
      
      - name: Fetch Data from API
        env:
          RAPIDAPI_KEY: ${{ secrets.RAPIDAPI_KEY }}
        run: |
          curl -X GET \
          "https://api-football-v1.p.rapidapi.com/v3/fixtures?date=$(date +%Y-%m-%d)" \
          -H "x-rapidapi-host: api-football-v1.p.rapidapi.com" \
          -H "x-rapidapi-key: $RAPIDAPI_KEY" \
          -o data/matches.json || echo "API fetch failed"
      
      - name: Commit & Push Changes
        run: |
          git config --global user.name "GitHub Actions"
          git config --global user.email "actions@github.com"
          git add data/matches.json
          git diff --quiet || (git commit -m "Auto-update matches data [skip ci]" && git push)
