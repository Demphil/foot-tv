<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>مباريات كرة القدم</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="assets/css/main.css">
    <link rel="stylesheet" href="assets/css/matches.css">
    <link rel="icon" href="assets/images/favicon.ico">
</head>
<body>
    <!-- Header Section -->
    <header class="header">
        <div class="container">
            <div class="logo">
                <a href="index.html">
                    <img src="assets/images/logo.png" alt="شعار الموقع">
                    <span>كرة القدم</span>
                </a>
            </div>
            <nav class="main-nav">
                <ul>
                    <li><a href="index.html"><i class="fas fa-home"></i> الرئيسية</a></li>
                    <li><a href="matches.html" class="active"><i class="fas fa-futbol"></i> المباريات</a></li>
                    <li><a href="news.html"><i class="fas fa-newspaper"></i> الأخبار</a></li>
                </ul>
            </nav>
            <div class="mobile-menu-btn">
                <i class="fas fa-bars"></i>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="matches-main">
        <div class="container">
            <h1><i class="fas fa-futbol"></i> جدول المباريات</h1>
            
            <!-- Filter Section -->
            <div class="filters">
                <div class="date-filter">
                    <button id="today-btn" class="active">اليوم</button>
                    <button id="tomorrow-btn">غداً</button>
                    <button id="week-btn">هذا الأسبوع</button>
                </div>
                <div class="league-filter">
                    <select id="league-select">
                        <option value="all">كل البطولات</option>
                        <option value="PL">الدوري الإنجليزي</option>
                        <option value="PD">الدوري الإسباني</option>
                        <option value="SA">الدوري الإيطالي</option>
                        <option value="BL1">الدوري الألماني</option>
                        <option value="FL1">الدوري الفرنسي</option>
                        <option value="SAU">الدوري السعودي</option>
                        <option value="MAR1">الدوري المغربي</option>
                    </select>
                </div>
            </div>

            <!-- Loading Indicator -->
            <div id="loading-indicator" class="loading-indicator">
                <i class="fas fa-spinner fa-spin"></i> جاري تحميل البيانات...
            </div>

            <!-- Matches Containers -->
            <div id="today-matches" class="matches-container"></div>
            <div id="tomorrow-matches" class="matches-container" style="display:none;"></div>
            <div id="week-matches" class="matches-container" style="display:none;"></div>

            <!-- Error Container -->
            <div id="error-container" class="error-container" style="display: none;"></div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <p>&copy; <span id="current-year"></span> موقع مباريات كرة القدم. جميع الحقوق محفوظة.</p>
        </div>
    </footer>

    <!-- Scripts -->
    <script type="module">
        // Configuration
        window.ENV = {
            FOOTBALL_DATA_KEY: '8d831470f41e4dbe983fba512cc0c795' // استبدلها بمفتاحك الفعلي
        };

        // Imports
        import { FootballAPI } from './assets/js/api.js';
        import { MatchRenderer } from './assets/js/matches.js';

        // Update copyright year
        document.getElementById('current-year').textContent = new Date().getFullYear();

        // Initialize app
        document.addEventListener('DOMContentLoaded', async () => {
            try {
                await MatchRenderer.init();
                
                // Setup filter buttons
                document.getElementById('today-btn').addEventListener('click', () => {
                    document.querySelectorAll('.matches-container').forEach(container => {
                        container.style.display = 'none';
                    });
                    document.getElementById('today-matches').style.display = 'block';
                    document.querySelectorAll('.date-filter button').forEach(btn => {
                        btn.classList.remove('active');
                    });
                    this.classList.add('active');
                });

                document.getElementById('tomorrow-btn').addEventListener('click', function() {
                    document.querySelectorAll('.matches-container').forEach(container => {
                        container.style.display = 'none';
                    });
                    document.getElementById('tomorrow-matches').style.display = 'block';
                    document.querySelectorAll('.date-filter button').forEach(btn => {
                        btn.classList.remove('active');
                    });
                    this.classList.add('active');
                });

                document.getElementById('week-btn').addEventListener('click', async function() {
                    document.querySelectorAll('.matches-container').forEach(container => {
                        container.style.display = 'none';
                    });
                    document.getElementById('week-matches').style.display = 'block';
                    document.querySelectorAll('.date-filter button').forEach(btn => {
                        btn.classList.remove('active');
                    });
                    this.classList.add('active');
                    
                    // Load week matches
                    try {
                        const today = new Date();
                        const weekMatches = [];
                        
                        for (let i = 0; i < 7; i++) {
                            const date = new Date(today);
                            date.setDate(today.getDate() + i);
                            const formattedDate = MatchRenderer.formatDate(date);
                            const matches = await MatchRenderer.getFilteredMatches(formattedDate);
                            weekMatches.push(...matches);
                        }
                        
                        document.getElementById('week-matches').innerHTML = 
                            weekMatches.map(match => MatchRenderer.getMatchHTML(match)).join('') || 
                            MatchRenderer.getNoMatchesHTML();
                    } catch (error) {
                        console.error('Error loading week matches:', error);
                        document.getElementById('week-matches').innerHTML = 
                            MatchRenderer.getNoMatchesHTML();
                    }
                });

            } catch (error) {
                console.error('Initialization error:', error);
                MatchRenderer.showError(error);
            }
        });
    </script>
</body>
</html>
